\documentclass[a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage[slovene]{babel}
\usepackage{graphicx}
\usepackage{hyperref}
\usepackage[nottoc]{tocbibind}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{amsmath}
\usepackage{ dsfont }
\usepackage{siunitx}
\usepackage{multimedia}
\usepackage[table,xcdraw]{xcolor}
\setlength\parindent{0pt}

\usepackage{minted}
\usepackage{listings}
\usepackage{tcolorbox}
\tcbuselibrary{listings, minted, skins}

\newcommand{\ddd}{\mathrm{d}}
\newcommand\myworries[1]{\textcolor{red}{#1}}
\newcommand{\Dd}[3][{}]{\frac{\ddd^{#1} #2}{\ddd #3^{#1}}}

\newtcblisting{pythonlst}{listing only, minted language=python3, minted style=paraiso-dark,
    colback=bg, enhanced, frame hidden, minted options={, 
    fontsize=\footnotesize, tabsize=2, breaklines, autogobble}}

\definecolor{inline}{RGB}{187,57,82}
\definecolor{bg}{RGB}{22,43,58}
\setminted[python3]{bgcolor=bg, fontsize=\footnotesize}

\begin{document}
\begin{titlepage}
    \begin{center}
        \includegraphics[]{logo.png}
        \vspace*{3cm}
        
        \Huge
        \textbf{Linearno programiranje}
        
        \vspace{0.5cm}
        \large
        2. naloga pri Modelski analizi 1

        \vspace{4.5cm}
        
        \textbf{Avtor:} Marko Urbanč (28232019)\ \\
        \textbf{Predavatelj:} prof. dr. Simon Širca\ \\
        \textbf{Asistent:} doc. dr. Miha Mihovilovič\ \\
        
        \vspace{2.8cm}
        
        \large
        17.10.2023
    \end{center}
\end{titlepage}
\tableofcontents
\newpage
\section{Uvod}
Linearna optimizacija je zadnje čase zelo vroča tema, tako da me veseli, da sem se je lahko lotil tudi sam. 
Linearno programiranje oz. linearna optimizacija je metoda za iskanje maksimuma ali minimuma linearnega izraza,
ki je podvržen linearnim omejitvam. Omenjen linearni izraz je funkcija več spremenljivk, ki najpogosteje ovrednoti
oz. oceni neko količino, ki jo želimo optimizirati. To je lahko npr. dobiček, strošek, količina proizvodnje, itd.
zato to funkcijo imenujemo \texttt{cost function} oz. \texttt{objective function}. Linearno programiranje je torej
metoda, ki nam omogoča, da z linearno funkcijo in linearnimi omejitvami poiščemo optimalno rešitev. Uporablja v 
različnih panogah, kot so ekonomija, logistika, telekomunikacije, transport, kot pa tudi v znanosti, kot je npr. 
fizika. \\

Torej če si to pogledamo v matematični notaciji imamo našo cost funkcijo $f(x_1, x_2, \dots, x_n)$, 
definirano kot neko linearno kombinacijo spremenljivk:

\begin{equation}
    f(x_1, x_2, \dots, x_n) = c_1x_1 + c_2x_2 + \dots + c_nx_n\>.
\end{equation}

in set vezi, ki so pogosto izražene kot neenačbe:

\begin{equation}
    \begin{split}
        a_{11}x_1 + a_{12}x_2 + \dots + a_{1n}x_n &\leq b_1\>, \\
        a_{21}x_1 + a_{22}x_2 + \dots + a_{2n}x_n &\leq b_2\>, \\
        \vdots \qquad \qquad \quad\\
        a_{m1}x_1 + a_{m2}x_2 + \dots + a_{mn}x_n &\leq b_m\>. \\
    \end{split}
\end{equation}

To je pravzaprav to kar se tiče matematičnega opisa osnovnega problema. Seveda so potem izvedenke postopkov
oz. algoritmov malo bolj zapletene, ampak to žal ni namen te naloge. \\

Dotično pri tej nalogi si bomo pogledali problem optimizacije diete. Posebna omemba ni potrebna, kako 
pomembno je to, da se prehranjujemo zdravo in uravnoteženo. Vendar pa je to v današnjem času vse težje,
saj je na voljo ogromno različnih živil, ki so vse prej kot zdrava. Zato je toliko bolj pomembno, da
se zavedamo, kaj jemo in da se prehranjujemo zdravo. Vendar pa je to včasih težko, saj je veliko ljudi
prezaposlenih in nimajo časa, da bi se ukvarjali s tem. Skratka ideja je taka, da bomo za dane želje 
kar se tiče hranilnih snovi, poskusili najti optimalno dieto. Optimalno pa je tu mišljeno v tem smislu,
kot ga uporabnik določi. Zagotovo bo razlika med tem, ali se minimizira količina hrane, ki jo je potrebno
pojesti, cena hrane, količina določene hranilne snovi ali pa kalorična vrednost. 

\section{Naloga}
Naloga torej zahteva, da za dano tabelo živil in njihovih hranilnih vrednosti, najdemo optimalno dieto, kjer minimiziramo
kalorije, če zahtevamo sledeče:

\begin{enumerate}
    \item \begin{itemize}
        \item Vsaj 70 g maščob
        \item Vsaj 310 g ogljikovih hidratov
        \item Vsaj 50 g proteinov
        \item Vsaj 1000 mg kalcija
        \item Vsaj 18 mg železa
        \item Dnevni obroki naj ne presežejo 2000 g
    \end{itemize}

    Ta osnovni model lahko potem nadgradimo s tem da dodamo še:
    \begin{itemize}
        \item Vsaj 60 mg Vitamina C
        \item Vsaj 3500 mg Kalija
        \item Med 500 mg in 2400 mg Natrija
    \end{itemize}

    \item Potem pa poglejmo kako se rezultat razlikuje še zahtevamo vsaj $2000$ kcal in minimiziramo
    vnos maščob.

    \item Minimizirajmo zdaj ceno diete
    \item Dodatne izvedbe omejitev za izboljšave uravnoteženosti diete

\end{enumerate}

\section{Opis reševanja}
Reševanja sem se lotil v klasično v Pythonu. Pri tej nalogi je močno prišel v upoštev 
pythonian princip, da za vse že obstaja neka knjižnica. In res je tako, za reševanje linearne 
optimizacije obstaja knjižnica \texttt{PuLP}, ki je zelo enostavna za uporabo in ima še kar solidno 
dokumentacijo. Pravzaprav je njihov prvi demonstracijski zgled zelo podoben našemu, z razliko da oni
mešajo meso v mačji hrani. Poleg tega pa seveda pridejo zraven še standardni \texttt{numpy}, \texttt{pandas}
in tokrat zaradi malo alterative izbire vizualizacije še \texttt{holoviews}. \\


\subsection{\texttt{PuLP}: basic cookbook}
Kot sem že omenil, je knjižnica \texttt{PuLP} zelo enostavna za uporabo. Lahko na hitro povzamem postopek
ker tako ali tako trenutno čakam, da se mi predprocesirajo podatki za (hopefully uspe) zadnji del naloge.
Torej začnemo s tem da uvozimo knjižnico in definiramo problem. 

\begin{pythonlst}
    from pulp import *
    import pandas as pd

    # Create the "prob"  variable to contain the problem data
    prob = LpProblem("Diet Problem", LpMinimize)
\end{pythonlst}

Sledi nalaganje podatkov iz tabele živil in ustvarjanje spremenljivk. Spremenljivke so v tem primeru
količina živila, ki ga bomo pojedli. 

\begin{pythonlst}
    df = pd.read_table('Data/table.dat', sep=',', skiprows=2, index_col=0)

    # Create a list of the food items
    food_items = list(df.index)

    # Create variables. These variables are the amounts of each food item to buy
    food_vars = LpVariable.dicts("Food", food_items, lowBound=0, cat='Continuous')
\end{pythonlst}

Okay sedaj pa definiramo še našo cost funkcijo. V tem osnovnem primeru bo to količina kalorij, ki jih
bomo zaužili.

\begin{pythonlst}
    # Define objective function and add it to the problem
    prob += lpSum([df.loc[i, 'Energija[kcal]'] * food_vars[i] for i in food_items]), "Total energy intake per person"
\end{pythonlst}

Zelo praktično je, da v bistvu kar prištevamo izraze k našemu problemu. Tako lahko zelo enostavno dodajamo
vezi. Storimo to.

\begin{pythonlst}
    # And now we can add the constraints
    prob += lpSum([df.loc[i, 'Mascobe[g]'] * food_vars[i] for i in food_items]) >= 70, "FatRequirement"
    prob += lpSum([df.loc[i, 'Ogljikovi_Hidrati[g]'] * food_vars[i] for i in food_items]) >= 310, "CarbohydrateRequirement"
    prob += lpSum([df.loc[i, 'Proteini[g]'] * food_vars[i] for i in food_items]) >= 50, "ProteinRequirement"
    prob += lpSum([df.loc[i, 'Ca[mg]'] * food_vars[i] for i in food_items]) >= 1000, "CalciumRequirement"
    prob += lpSum([df.loc[i, 'Fe[mg]'] * food_vars[i] for i in food_items]) >= 18, "IronRequirement"
    prob += lpSum([100 * food_vars[i] for i in food_items]) <= 2000, "MassLimit"
\end{pythonlst}

Zdaj ko smo model tako lepo definirali je smiselno, da ga tudi spravimo v datoteko. Nato pa kličemo 
reševanje. \texttt{PuLP} bo sam poskrbel za izbiro algoritma, ki bo najbolj primeren za naš problem.

\begin{pythonlst}
    model_name = "diet-model_no-weight-con.lp"
    prob.writeLP(f"Models/{model_name}")

    # Slove the problem
    prob.solve()
\end{pythonlst}

In na koncu še spravimo rešitev v neko obliko, ki jo lahko potem uporabimo za vizualizacijo.

\begin{pythonlst}
    # Save the solution to a file with numpy
    var_names = np.array([v.name for v in prob.variables()])
    var_values = np.array([v.varValue for v in prob.variables()])
    solution = np.column_stack((var_names, var_values))

    np.savetxt(f"Solutions/{model_name}-sol.dat", solution, delimiter=",", fmt="\%s", header="Item,Value")
\end{pythonlst}

Če bi nas zanimalo še takojšnje ovrednotenje lahko z spodnjim blokom kode izpišemo nekaj uporabnih
informacij.

\begin{pythonlst}
    # Print the status of the solution
    print("Status:", LpStatus[prob.status])

    # Print the optimal solution
    for v in prob.variables():
        print(v.name, "=", v.varValue)
    print("Total energy intake per person = ", value(prob.objective))
\end{pythonlst}

Od tod naprej pa lahko poljubno zapletemo vezi (dokler ostanejo linearne seveda) ali pa spremenimo
vhodne podatke. \\

\section{Rezultati}
Tole poročilo bo res med krajšimi, kar sem jih napisal, kar se tiče surove vsebine, ampak 
dejstvo je, da je narava naloge taka, da gremo lahko takoj na zabavne rezultate. \\

\subsection{Osnovni model}
\subsection{Osnovni model brez omejitve mase}
Najprej si poglejmo rezultate osnovnega modela, kjer ne omejujemo mase. Torej lahko pojemo kolikor
želimo. Rezultati so prikazani na sliki \ref{fig:basic-no-mass}. \\
\begin{figure}[H]
    \centering
    \makebox[\textwidth][c]{%
    \includegraphics[width=1.2\textwidth]{../Images/diet-model_basic-no-weight-visual.png}
    }
    \caption{Osnovni model brez omejitve mase}
    \label{fig:basic-no-mass}
\end{figure}

Tu smo dobili znanstveni dokaz, da nam radenska res da tri srčke. Presenetljivo številke niso tako
nerealistično velike kot bi lahko bile in kot bomo videli, da bodo, tako da bi dieta, ki bi slonela
na radenski, pomfriu, medu in kakavu lahko bila še kar obetavna. Radenska je fenomenalna izbira, ker 
optimiziramo kalorije, ki jih zaužijemo. Voda ie. radenska pa ima zelo malo kalorij, tako da je to
zelo dobra izbira, hkrati pa ima neko količino mineralov, ki jih potrebujemo in tako prevlada v izboru.

\subsubsection{Osnovni model z omejitvijo mase}
Sedaj pa si poglejmo še rezultate, kjer omejujemo maso na $2000$ g. Rezultati so prikazani na 
sliki \ref{fig:basic}. \\

\begin{figure}[H]
    \centering
    \makebox[\textwidth][c]{%
    \includegraphics[width=1.2\textwidth]{../Images/diet-model_basic-visual.png}
    }
    \caption{Osnovni model z omejitve mase}
    \label{fig:basic}
\end{figure}

Meni se zdi neznosno amusing rezultat, da je glede na naše preproste vezi, optimalna dieta takšna, da se
pravzaprav ubiješ s soljo. Dodatno pa ješ kakav za mineralni vnos. To bi lahko bil jedilnik astronavtov v 
distopični prihodnosti, kjer smo nekako ugotovili, kako varno lahko jemo ogromne količine soli. Simpatično je,
da imamo tudi za okras in okus malo pomfrija. Mogoče so pa to your average \textit{Mc D's} pomfriji, kjer je
verjetno brez šale na $17$ g pomfrija $1.4$ kg soli. Sicer pa verjetno je tu argument podoben kot pri radenski.
Kar naenkrat rabimo nekaj kar je mineralno bolj gosto in kaj je boljše kot mineralna voda? Mineral sam. Tudi sol 
ima precej nizko kalorično vrednost, tako da je to zelo dobra izbira. O smrtnih posledicah hipernatriemije pa
ne bi.

\subsubsection{Osnovni model z omejitvijo mase in dodatnimi omejitvami}
Zdaj pa izključimo to zoprno sol in dodajmo še tiste dodatne omejitve, kjer si postavimo nek smiselen interval
za količino natrija v naši hrani. Ob tem pa lahko še dodamo par vezi, ker lahko. Rezultati so prikazani na
sliki \ref{fig:basic-add}. \\

\begin{figure}[H]
    \centering
    \makebox[\textwidth][c]{%
    \includegraphics[width=1.2\textwidth]{../Images/diet-model_basic-add-visual.png}
    }
    \caption{Osnovni model z omejitve mase in dodatnimi omejitvami}
    \label{fig:basic-add}
\end{figure}

Opa, to pa je že nekaj kar bi lahko človek rekel, da je popolnoma passable. Dober liter radenske se ne zdi
pretiravanje, če te mehurčki ne motijo. Potem pa malo solate, malo sadja in seveda (tukaj odpove heh..) pol kile 
kakava.



\section{Komentarji in izboljšave}

\newpage
\bibliographystyle{unsrt}
\bibliography{sources}
\end{document}
